---

- name: install yum-cron
  shell: yum -y install yum-cron
  when: install_yum_cron == "true"

- name: add skip_broken=true for yum-cron
  shell: grep -q -F 'skip_broken=true' /etc/yum/yum-cron.conf || echo 'skip_broken=true' >> /etc/yum/yum-cron.conf
  when: install_yum_cron == "true"

- name: set apply_updates = yes for yum-cron
  shell: sed -i 's/apply_updates = no/apply_updates = yes/' /etc/yum/yum-cron.conf
  when: install_yum_cron == "true"

- name: "Set exlude {{ exclude_yum_cron }} in yum-cron"
  shell: |
    if grep -q 'exclude = ' /etc/yum/yum-cron.conf; then 
      sed -i 's/^exclude =.*$/exclude = {{ exclude_yum_cron }}/' /etc/yum/yum-cron.conf
    else
      echo 'exclude = {{ exclude_yum_cron }}' >> /etc/yum/yum-cron.conf
    fi
  when: install_yum_cron == "true" and exclude_yum_cron is defined

- name: enable and restart yum-cron
  service:
    name: yum-cron
    enabled: yes
    state: restarted
  when: install_yum_cron == "true"
